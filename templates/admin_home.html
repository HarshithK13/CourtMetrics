{% extends "admin_base.html" %}

{% block title %}Admin Home{% endblock %}

{% block content %}
<div class="admin-home-container">
    <h2>Admin Dashboard</h2>
    
    <!-- User Management Table -->
    <h3>User Management</h3>
    <table class="user-table">
        <tr>
            <th>Email ID</th>
            <th>Username</th>
            <th>Mobile</th>
            <th>Address</th>
            <th>Actions</th>
        </tr>
        {% for user in users %}
        <tr id="user-{{ user._id }}">
            <td>{{ user.email }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.Mobile }}</td>
            <td>{{ user.Address }}</td>
            <td>
                <button onclick="deleteUser('{{ user._id }}')">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
    // Function to delete a user
    function deleteUser(userId) {
        if (confirm("Are you sure you want to delete this user?")) {
            const accessToken = localStorage.getItem('access_token');
            const userName = localStorage.getItem('user_name');

            fetch(`/delete_user/${userId}`, { 
                method: "DELETE", 
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("User deleted successfully!");
                    document.getElementById(`user-${userId}`).remove();  // Remove the user row from the table
                } else {
                    alert("Error: " + data.message);
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while deleting the user.");
            });
        }
    }

    // Check if the admin is logged in
    document.addEventListener("DOMContentLoaded", function () {
        const accessToken = localStorage.getItem('access_token');
        const userName = localStorage.getItem('user_name');

        if (!accessToken || !userName) {
            alert("You are not logged in as admin. Redirecting to admin login page...");
            window.location.href = "/admin_login";  // Redirect to the admin login page
        }
    });
</script>
{% endblock %}